{"version":3,"sources":["ngm.js","column.js","dashboard.js","provider.js","row.js","widget-content.js","widget.js","ngm-dashboard-framework.tpl.js","ngm-dashboard-framework.min.js"],"names":["window","undefined","angular","module","value","directive","$log","$compile","ngmTemplatePath","rowTemplate","dashboard","restrict","replace","scope","column","editMode","ngmModel","options","templateUrl","link","$scope","$element","col","cid","id","cloned","append","el","attr","setTimeout","$","find","each","i","d","search","closest","slideDown","bind","$event","toggleClass","hasClass","slideUp","initInjector","injector","$http","get","download","csv","filename","request","dataKey","success","data","csvHeader","rows","map","row","record","forEach","key","push","csvRow","join","csvData","document","createElement","href","encodeURIComponent","target","body","appendChild","click","remove","error","deferred","reject","pdf","console","log","setMetrics","template","icon","type","hover","metrics","tooltip","color","size","moment","format","$e","$rootScope","stringToBoolean","string","isDefined","toLowerCase","Boolean","transclude","structure","name","collapsible","editable","maximizable","ngmWidgetFilter","controller","model","widgetFilter","structureName","updateWidgets","params","$broadcast","$watch","oldVal","newVal","structures","copy","title","titleTemplateUrl","editClass","$attr","provider","widgets","widgetsPath","messageTemplate","loadingTemplate","this","widget","w","extend","reload","edit","path","getData","$q","defer","resolve","promise","$get","columnTemplate","columns","isArray","$sce","$templateCache","$controller","$injector","parseUrl","url","parsedUrl","indexOf","substring","getTemplate","tpl","getTrustedResourceUrl","response","put","compileWidget","currentScope","content","html","templateScope","$new","config","base","parent","resolvers","$tpl","isString","invoke","all","then","locals","templateCtrl","controllerAs","children","contents","reason","msg","warn","$destroy","$on","event","preLink","definition","wid","fromJson","widgetState","isCollapsed","debug","postLink","compile","pre","post","run"],"mappings":"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","file":"ngm-dashboard-framework.min.js","sourcesContent":["/*\n * The MIT License\n *\n * Copyright (c) 2015, Patrick Fitzgerald\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\nangular.module('ngm', ['ngm.provider'])\n  .value('ngmTemplatePath', '../src/templates/')\n  .value('rowTemplate', '<ngm-dashboard-row row=\"row\" ngm-model=\"ngmModel\" options=\"options\" edit-mode=\"editMode\" ng-repeat=\"row in column.rows\" />')\n  .value('columnTemplate', '<ngm-dashboard-column column=\"column\" ngm-model=\"ngmModel\" options=\"options\" edit-mode=\"editMode\" ng-repeat=\"column in row.columns\" />')\n  .value('ngmVersion', '<<ngmVersion>>');\n","/*\n* The MIT License\n*\n* Copyright (c) 2015, Patrick Fitzgerald\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in\n* all copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\n\n/* global angular */\nangular.module('ngm')\n  .directive('ngmDashboardColumn', function ($log, $compile, ngmTemplatePath, rowTemplate, dashboard) {\n    'use strict';\n\n    /**\n     * finds a widget by its id in the column\n     */\n    function findWidget(column, index){\n      var widget = null;\n      for (var i=0; i<column.widgets.length; i++){\n        var w = column.widgets[i];\n        if (w.wid === index){\n          widget = w;\n          break;\n        }\n      }\n      return widget;\n    }\n\n    /**\n     * finds a column by its id in the model\n     */\n    function findColumn(model, index){\n      var column = null;\n      for (var i=0; i<model.rows.length; i++){\n        var r = model.rows[i];\n        for (var j=0; j<r.columns.length; j++){\n          var c = r.columns[j];\n          if ( c.cid === index ){\n            column = c;\n            break;\n          } else if (c.rows){\n            column = findColumn(c, index);\n          }\n        }\n        if (column){\n          break;\n        }\n      }\n      return column;\n    }\n\n    /**\n     * get the ngm id from an html element\n     */\n    function getId(el){\n      var id = el.getAttribute('ngm-id');\n      return id ? parseInt(id) : -1;\n    }\n\n    return {\n      restrict: 'E',\n      replace: true,\n      scope: {\n        column: '=',\n        editMode: '=',\n        ngmModel: '=',\n        options: '='\n      },\n      templateUrl: ngmTemplatePath + 'dashboard-column.html',\n      link: function ($scope, $element) {\n        // set id\n        var col = $scope.column;\n        if (!col.cid){\n          col.cid = dashboard.id();\n        }\n        // be sure to tell Angular about the injected directive and push the new row directive to the column\n        $compile(rowTemplate)($scope, function(cloned) {\n          $element.append(cloned);\n        });\n      }\n    };\n  });\n","/*\n * The MIT License\n *\n * Copyright (c) 2015, Patrick Fitzgerald\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * @ngdoc directive\n * @name ngm.directive:ngmDashboard\n * @element div\n * @restrict EA\n * @scope\n * @description\n *\n * `ngmDashboard` is a directive which renders the dashboard with all its\n * components. The directive requires a name attribute. The name of the\n * dashboard can be used to store the model.\n *\n * @param {string} name name of the dashboard. This attribute is required.\n * @param {boolean=} editable false to disable the editmode of the dashboard.\n * @param {boolean=} collapsible true to make widgets collapsible on the dashboard.\n * @param {boolean=} maximizable true to add a button for open widgets in a large modal panel.\n * @param {string=} structure the default structure of the dashboard.\n * @param {object=} ngmModel model object of the dashboard.\n * @param {function=} ngmWidgetFilter function to filter widgets on the add dialog.\n */\n\nangular.module('ngm')\n  // toggles accordian classes for \n  .directive('ngmMenu', function() {\n\n    return {\n      \n      // Restrict it to be an attribute in this case\n      restrict: 'A',\n      \n      // responsible for registering DOM listeners as well as updating the DOM\n      link: function(scope, el, attr) {\n\n        // set initial menu style - has to be a better way?\n        setTimeout(function(){\n\n          // For all itmes\n          $('.side-menu').find('li').each(function(i, d) {\n\n            // find the row that is active\n            if ($(d).attr('class').search('active') > 0) {\n\n              // set list header\n              $(d).closest('.bold').attr('class', 'bold active');\n              \n              // set z-depth-1\n              $(d).closest('.bold').find('a').attr('class', \n                  $(d).closest('.bold').find('a').attr('class') + ' z-depth-1' );\n\n              // slide down list\n              $(d).closest('.collapsible-body').slideDown();\n              $(d).closest('.collapsible-body').attr('class',\n                $(d).closest('.collapsible-body').attr('class') + ' active');\n            }\n          });\n\n        }, 0);\n\n        // on element click\n        el.bind( 'click', function( $event ) {\n          \n          // toggle list \n          el.toggleClass('active');\n          // toggle list \n          el.find('.collapsible-header').toggleClass('z-depth-1');\n\n          // toggle list rows active\n          el.find('.collapsible-body').toggleClass('active');\n\n          // toggle list rows animation\n          if (el.find('.collapsible-body').hasClass('active')) {\n            el.find('.collapsible-body').slideDown();\n          } else {\n            el.find('.collapsible-body').slideUp();\n          }\n          \n        });\n      }\n    };\n  })\n  .directive('ngmDashboardDownload',  function(dashboard) {\n\n    // get $http\n    var initInjector = angular.injector(['ng']);\n    var $http = initInjector.get('$http');\n\n    // client side download    \n    var download = {\n  \n      // prepare and stream CSV to client      \n      'csv': function(filename, request, dataKey){\n\n        // get data\n        $http(request)\n          .success(function(data){\n\n            // datatype\n            var csvHeader;\n            var type = 'data:text/csv;charset=utf-8';\n\n            // convert json to array\n            var rows = data[dataKey].map(function (row) {\n\n              // csv headers\n              csvHeader = [];\n              var record = [];\n\n              // access each value\n              angular.forEach(row, function(d, key){\n\n                // create flat array\n                csvHeader.push(key);\n                record.push(d);\n\n              });\n\n              // join as csv string\n              var csvRow = record.join()\n\n              // return\n              return csvRow\n\n            });\n\n            // compile csv data\n            var csvData = [];\n                csvData.push(csvHeader.join());\n                csvData.push(rows.join('\\n'));\n\n            // create element and add csv string\n            var el = document.createElement('a');\n                el.href = 'data:attachment/csv,' + encodeURIComponent(csvData);\n                el.target = '_blank';\n                el.download = filename + '.csv';\n\n            // append, download & remove\n            document.body.appendChild(el);\n            el.click();\n            el.remove();\n\n          })\n          .error(function(){\n            deferred.reject();\n          });\n      },\n\n      // client side PDF generation\n      'pdf': function(filename, request, dataKey){\n        console.log('PDF');\n      },\n\n      // writes metrics to rest api\n      'setMetrics': function(request){\n        $http(request)\n          .success(function(data){\n          }).error(function(){\n            deferred.reject();\n          });\n      }\n\n    }\n\n    return {\n      \n      // element or attrbute\n      restrict: 'EA',\n\n      replace: true,\n\n      template: '<a class=\"tooltipped\" data-position=\"top\" data-delay=\"50\" data-tooltip=\"{{ hover }}\" style=\"color: {{ icon.color }}\"><i class=\"{{ icon.size }} material-icons\">{{ icon.type }}</i></a>',      \n\n      scope: {\n        icon: '=',\n        type: '=',\n        hover: '=',\n        dataKey: '=',\n        filename: '=',\n        request: '=',\n        metrics: '='\n      },\n\n      // onclick\n      link: function(scope, el, attr) {\n\n        // init tooltip\n        $('.tooltipped').tooltip({\n          tooltip: 'Download CSV'\n        });\n\n        // set defaults\n        scope.icon = {\n          type: scope.icon && scope.icon.type ? scope.icon.type : 'ic_assignment_returned',\n          color: scope.icon && scope.icon.color ? scope.icon.color : '',\n          size: scope.icon && scope.icon.size ? scope.icon.size : 'small'\n        }\n        scope.type = scope.type ? scope.type : 'csv';\n        scope.hover = scope.hover ? scope.hover : 'Download ' + scope.type;\n        scope.dataKey = scope.dataKey ? scope.dataKey : 'data';\n        scope.filename = scope.filename ? scope.filename : moment().format();        \n        \n        // bind download event\n        el.bind( 'click', function($e) {\n\n          // prepare download\n          download[scope.type](scope.filename, scope.request, scope.dataKey);\n\n          // record metrics\n          if (scope.metrics) {\n            download.setMetrics(scope.metrics);\n          }\n\n        });\n\n      }\n    }\n\n  })\n  .directive('ngmDashboard', function ($rootScope, $log, dashboard, ngmTemplatePath) {\n    'use strict';\n\n    function stringToBoolean(string){\n      switch(angular.isDefined(string) ? string.toLowerCase() : null){\n        case 'true': case 'yes': case '1': return true;\n        case 'false': case 'no': case '0': case null: return false;\n        default: return Boolean(string);\n      }\n    }\n\n    function copyWidgets(source, target) {\n      if ( source.widgets && source.widgets.length > 0 ){\n        var w = source.widgets.shift();\n        while (w){\n          target.widgets.push(w);\n          w = source.widgets.shift();\n        }\n      }\n    }\n\n    /**\n    * Copy widget from old columns to the new model\n    * @param object root the model\n    * @param array of columns\n    * @param counter\n    */\n    function fillStructure(root, columns, counter) {\n      counter = counter || 0;\n\n      if (angular.isDefined(root.rows)) {\n        angular.forEach(root.rows, function (row) {\n          angular.forEach(row.columns, function (column) {\n            // if the widgets prop doesn't exist, create a new array for it.\n            // this allows ui.sortable to do it's thing without error\n            if (!column.widgets) {\n              column.widgets = [];\n            }\n\n            // if a column exist at the counter index, copy over the column\n            if (angular.isDefined(columns[counter])) {\n              // do not add widgets to a column, which uses nested rows\n              if (!angular.isDefined(column.rows)){\n                copyWidgets(columns[counter], column);\n                counter++;\n              }\n            }\n\n            // run fillStructure again for any sub rows/columns\n            counter = fillStructure(column, columns, counter);\n          });\n        });\n      }\n      return counter;\n    }\n\n    /**\n    * Read Columns: recursively searches an object for the 'columns' property\n    * @param object model\n    * @param array  an array of existing columns; used when recursion happens\n    */\n    function readColumns(root, columns) {\n      columns = columns || [];\n\n      if (angular.isDefined(root.rows)) {\n        angular.forEach(root.rows, function (row) {\n          angular.forEach(row.columns, function (col) {\n            columns.push(col);\n            // keep reading columns until we can't any more\n            readColumns(col, columns);\n          });\n        });\n      }\n\n      return columns;\n    }\n\n    function changeStructure(model, structure){\n      var columns = readColumns(model);\n      var counter = 0;\n\n      model.rows = angular.copy(structure.rows);\n\n      while ( counter < columns.length ){\n        counter = fillStructure(model, columns, counter);\n      }\n    }\n\n    function createConfiguration(type){\n      var cfg = {};\n      var config = dashboard.widgets[type].config;\n      if (config){\n        cfg = angular.copy(config);\n      }\n      return cfg;\n    }\n\n    /**\n     * Find first widget column in model.\n     *\n     * @param dashboard model\n     */\n    function findFirstWidgetColumn(model){\n      var column = null;\n      if (!angular.isArray(model.rows)){\n        $log.error('model does not have any rows');\n        return null;\n      }\n      for (var i=0; i<model.rows.length; i++){\n        var row = model.rows[i];\n        if (angular.isArray(row.columns)){\n          for (var j=0; j<row.columns.length; j++){\n            var col = row.columns[j];\n            if (!col.rows){\n              column = col;\n              break;\n            }\n          }\n        }\n        if (column){\n          break;\n        }\n      }\n      return column;\n    }\n\n    return {\n      replace: true,\n      restrict: 'EA',\n      transclude : false,\n      scope: {\n        structure: '@',\n        name: '@',\n        collapsible: '@',\n        editable: '@',\n        maximizable: '@',\n        ngmModel: '=',\n        ngmWidgetFilter: '='\n      },\n      controller: function($scope){\n        var model = {};\n        var structure = {};\n        var widgetFilter = null;\n        var structureName = {};\n        var name = $scope.name;\n\n        // Update widget configs with broadcast\n        $scope.ngmModel.updateWidgets = function(params){\n          $scope.$broadcast( 'updateWidgetConfigs', params );\n        }        \n\n        // Watching for changes on ngmModel\n        $scope.$watch('ngmModel', function(oldVal, newVal) {\n          // has model changed or is the model attribute not set\n          if (newVal !== null || (oldVal === null && newVal === null)) {\n            model = $scope.ngmModel;\n            widgetFilter = $scope.ngmWidgetFilter;\n            if ( ! model || ! model.rows ){\n              structureName = $scope.structure;\n              structure = dashboard.structures[structureName];\n              if (structure){\n                if (model){\n                  model.rows = angular.copy(structure).rows;\n                } else {\n                  model = angular.copy(structure);\n                }\n                model.structure = structureName;\n              } else {\n                $log.error( 'could not find structure ' + structureName);\n              }\n            }\n\n            if (model) {\n              if (!model.title){\n                model.title = 'Dashboard';\n              }\n              if (!model.titleTemplateUrl) {\n                model.titleTemplateUrl = ngmTemplatePath + 'dashboard-title.html';\n              }\n              $scope.model = model;\n            } else {\n              $log.error('could not find or create model');\n            }\n          }\n        }, true);\n\n        // edit mode\n        $scope.editMode = false;\n        $scope.editClass = '';\n\n      },\n      link: function ($scope, $element, $attr) {\n        // pass options to scope\n        var options = {\n          name: $attr.name,\n          editable: true,\n          maximizable: stringToBoolean($attr.maximizable),\n          collapsible: stringToBoolean($attr.collapsible)\n        };\n        if (angular.isDefined($attr.editable)){\n          options.editable = stringToBoolean($attr.editable);\n        }\n        $scope.options = options;\n      },\n      templateUrl: ngmTemplatePath + 'dashboard.html'\n    };\n  });\n","/*\n * The MIT License\n *\n * Copyright (c) 2015, Patrick Fitzgerald\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\n/**\n * @ngdoc object\n * @name ngm.dashboardProvider\n * @description\n *\n * The dashboardProvider can be used to register structures and widgets.\n */\nangular.module('ngm.provider', [])\n  .provider('dashboard', function(){\n\n    var widgets = {};\n    var widgetsPath = '';\n    var structures = {};\n    var messageTemplate = '<div class=\"alert alert-danger\">{}</div>';\n    var loadingTemplate = '\\\n      <div class=\"progress progress-striped active\">\\n\\\n        <div class=\"progress-bar\" role=\"progressbar\" style=\"width: 100%\">\\n\\\n          <span class=\"sr-only\">loading ...</span>\\n\\\n        </div>\\n\\\n      </div>';\n\n   /**\n    * @ngdoc method\n    * @name ngm.dashboardProvider#widget\n    * @methodOf ngm.dashboardProvider\n    * @description\n    *\n    * Registers a new widget.\n    *\n    * @param {string} name of the widget\n    * @param {object} widget to be registered.\n    *\n    *   Object properties:\n    *\n    *   - `title` - `{string=}` - The title of the widget.\n    *   - `description` - `{string=}` - Description of the widget.\n    *   - `config` - `{object}` - Predefined widget configuration.\n    *   - `controller` - `{string=|function()=}` - Controller fn that should be\n    *      associated with newly created scope of the widget or the name of a\n    *      {@link http://docs.angularjs.org/api/angular.Module#controller registered controller}\n    *      if passed as a string.\n    *   - `controllerAs` - `{string=}` - A controller alias name. If present the controller will be\n    *      published to scope under the `controllerAs` name.\n    *   - `template` - `{string=|function()=}` - html template as a string.\n    *   - `templateUrl` - `{string=}` - path to an html template.\n    *   - `reload` - `{boolean=}` - true if the widget could be reloaded. The default is false.\n    *   - `resolve` - `{Object.<string, function>=}` - An optional map of dependencies which should\n    *      be injected into the controller. If any of these dependencies are promises, the widget\n    *      will wait for them all to be resolved or one to be rejected before the controller is\n    *      instantiated.\n    *      If all the promises are resolved successfully, the values of the resolved promises are\n    *      injected.\n    *\n    *      The map object is:\n    *      - `key` – `{string}`: a name of a dependency to be injected into the controller.\n    *      - `factory` - `{string|function}`: If `string` then it is an alias for a service.\n    *        Otherwise if function, then it is {@link http://docs.angularjs.org/api/AUTO.$injector#invoke injected}\n    *        and the return value is treated as the dependency. If the result is a promise, it is\n    *        resolved before its value is injected into the controller.\n    *   - `edit` - `{object}` - Edit modus of the widget.\n    *      - `controller` - `{string=|function()=}` - Same as above, but for the edit mode of the widget.\n    *      - `template` - `{string=|function()=}` - Same as above, but for the edit mode of the widget.\n    *      - `templateUrl` - `{string=}` - Same as above, but for the edit mode of the widget.\n    *      - `resolve` - `{Object.<string, function>=}` - Same as above, but for the edit mode of the widget.\n    *      - `reload` - {boolean} - true if the widget should be reloaded, after the edit mode is closed.\n    *        Default is true.\n    *\n    * @returns {Object} self\n    */\n    this.widget = function(name, widget){\n      var w = angular.extend({reload: false}, widget);\n      if ( w.edit ){\n        var edit = {reload: true};\n        angular.extend(edit, w.edit);\n        w.edit = edit;\n      }\n      widgets[name] = w;\n      return this;\n    };\n\n    /**\n     * @ngdoc method\n     * @name ngm.dashboardProvider#widgetsPath\n     * @methodOf ngm.dashboardProvider\n     * @description\n     *\n     * Sets the path to the directory which contains the widgets. The widgets\n     * path is used for widgets with a templateUrl which contains the\n     * placeholder {widgetsPath}. The placeholder is replaced with the\n     * configured value, before the template is loaded, but the template is\n     * cached with the unmodified templateUrl (e.g.: {widgetPath}/src/widgets).\n     * The default value of widgetPaths is ''.\n     *\n     *\n     * @param {string} path to the directory which contains the widgets\n     *\n     * @returns {Object} self\n     */\n    this.widgetsPath = function(path){\n      widgetsPath = path;\n      return this;\n    };\n\n   /**\n    * @ngdoc method\n    * @name ngm.dashboardProvider#structure\n    * @methodOf ngm.dashboardProvider\n    * @description\n    *\n    * Registers a new structure.\n    *\n    * @param {string} name of the structure\n    * @param {object} structure to be registered.\n    *\n    *   Object properties:\n    *\n    *   - `rows` - `{Array.<Object>}` - Rows of the dashboard structure.\n    *     - `styleClass` - `{string}` - CSS Class of the row.\n    *     - `columns` - `{Array.<Object>}` - Columns of the row.\n    *       - `styleClass` - `{string}` - CSS Class of the column.\n    *\n    * @returns {Object} self\n    */\n    this.structure = function(name, structure){\n      structures[name] = structure;\n      return this;\n    };\n\n   /**\n    * @ngdoc method\n    * @name ngm.dashboardProvider#messageTemplate\n    * @methodOf ngm.dashboardProvider\n    * @description\n    *\n    * Changes the template for messages.\n    *\n    * @param {string} template for messages.\n    *\n    * @returns {Object} self\n    */\n    this.messageTemplate = function(template){\n      messageTemplate = template;\n      return this;\n    };\n\n   /**\n    * @ngdoc method\n    * @name ngm.dashboardProvider#loadingTemplate\n    * @methodOf ngm.dashboardProvider\n    * @description\n    *\n    * Changes the template which is displayed as\n    * long as the widget resources are not resolved.\n    *\n    * @param {string} loading template\n    *\n    * @returns {Object} self\n    */\n    this.loadingTemplate = function(template){\n      loadingTemplate = template;\n      return this;\n    };\n\n   /**\n    * @ngdoc method\n    * @name ngm.dashboardProvider#getData\n    * @methodOf ngm.dashboardProvider\n    * @description\n    *\n    * Fetches data using $http\n    *\n    * @param {object} $http request\n    *\n    * @returns {deferred.promise} self\n    */\n    this.getData = function(request){\n      var initInjector = angular.injector(['ng']);\n      var $q = initInjector.get('$q');\n      var $http = initInjector.get('$http');\n\n      var deferred = $q.defer();\n      $http(request)\n        .success(function(data){\n          deferred.resolve(data);\n        })\n        .error(function(){\n          deferred.reject();\n        });\n\n      return deferred.promise;\n    };\n\n   /**\n    * @ngdoc service\n    * @name ngm.dashboard\n    * @description\n    *\n    * The dashboard holds all options, structures and widgets.\n    *\n    * @property {Array.<Object>} widgets Array of registered widgets.\n    * @property {string} widgetsPath Default path for widgets.\n    * @property {Array.<Object>} structures Array of registered structures.\n    * @property {string} messageTemplate Template for messages.\n    * @property {string} loadingTemplate Template for widget loading.\n    *\n    * @returns {Object} self\n    */\n    this.$get = function(){\n      var cid = 0;\n\n      return {\n        widgets: widgets,\n        widgetsPath: widgetsPath,\n        structures: structures,\n        messageTemplate: messageTemplate,\n        loadingTemplate: loadingTemplate,\n\n        /**\n         * @ngdoc method\n         * @name ngm.dashboard#id\n         * @methodOf ngm.dashboard\n         * @description\n         *\n         * Creates an ongoing numeric id. The method is used to create ids for\n         * columns and widgets in the dashboard.\n         */\n        id: function(){\n          return ++cid;\n        }\n      };\n    };\n\n  });\n","/*\n* The MIT License\n*\n* Copyright (c) 2015, Patrick Fitzgerald\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in\n* all copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\n\n/* global angular */\nangular.module('ngm')\n  .directive('ngmDashboardRow', function ($compile, ngmTemplatePath, columnTemplate) {\n    'use strict';\n\n    return {\n      restrict: 'E',\n      replace: true,\n      scope: {\n        row: '=',\n        ngmModel: '=',\n        editMode: '=',\n        options: '='\n      },\n      templateUrl: ngmTemplatePath + 'dashboard-row.html',\n      link: function ($scope, $element) {\n        if (angular.isDefined($scope.row.columns) && angular.isArray($scope.row.columns)) {\n          $compile(columnTemplate)($scope, function(cloned) {\n            $element.append(cloned);\n          });\n        }\n      }\n    };\n  });\n","/*\n * The MIT License\n *\n * Copyright (c) 2015, Patrick Fitzgerald\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\nangular.module('ngm')\n  .directive('ngmWidgetContent', function($log, $q, $sce, $http, $templateCache,\n    $compile, $controller, $injector, dashboard) {\n\n    function parseUrl(url){\n      var parsedUrl = url;\n      if ( url.indexOf('{widgetsPath}') >= 0 ){\n        parsedUrl = url.replace('{widgetsPath}', dashboard.widgetsPath)\n                       .replace('//', '/');\n        if (parsedUrl.indexOf('/') === 0){\n          parsedUrl = parsedUrl.substring(1);\n        }\n      }\n      return parsedUrl;\n    }\n\n    function getTemplate(widget){\n      var deferred = $q.defer();\n\n      if ( widget.template ){\n        deferred.resolve(widget.template);\n      } else if (widget.templateUrl) {\n        // try to fetch template from cache\n        var tpl = $templateCache.get(widget.templateUrl);\n        if (tpl){\n          deferred.resolve(tpl);\n        } else {\n          var url = $sce.getTrustedResourceUrl(parseUrl(widget.templateUrl));\n          $http.get(url)\n            .success(function(response){\n              // put response to cache, with unmodified url as key\n              $templateCache.put(widget.templateUrl, response);\n              deferred.resolve(response);\n            })\n            .error(function(){\n              deferred.reject('could not load template');\n            });\n        }\n      }\n\n      return deferred.promise;\n    }\n\n    function compileWidget($scope, $element, currentScope) {\n      var model = $scope.model;\n      var content = $scope.content;\n\n      // display loading template\n      $element.html(dashboard.loadingTemplate);\n\n      // create new scope\n      var templateScope = $scope.$new();\n\n      // pass config object to scope\n      if (!model.config) {\n        model.config = {};\n      }\n\n      templateScope.config = model.config;\n\n      // local injections\n      var base = {\n        $scope: templateScope,\n        $element: $element.parent(),\n        widget: model,\n        config: model.config\n      };\n\n      // get resolve promises from content object\n      var resolvers = {};\n      resolvers.$tpl = getTemplate(content);\n      if (content.resolve) {\n        angular.forEach(content.resolve, function(promise, key) {\n          if (angular.isString(promise)) {\n            resolvers[key] = $injector.get(promise);\n          } else {\n            resolvers[key] = $injector.invoke(promise, promise, base);\n          }\n        });\n      }\n\n      // resolve all resolvers\n      $q.all(resolvers).then(function(locals) {\n        angular.extend(locals, base);\n\n        // compile & render template\n        var template = locals.$tpl;\n        $element.html(template);\n        if (content.controller) {\n          var templateCtrl = $controller(content.controller, locals);\n          if (content.controllerAs){\n            templateScope[content.controllerAs] = templateCtrl;\n          }\n          $element.children().data('$ngControllerController', templateCtrl);\n        }\n        $compile($element.contents())(templateScope);\n      }, function(reason) {\n        // handle promise rejection\n        var msg = 'Could not resolve all promises';\n        if (reason) {\n          msg += ': ' + reason;\n        }\n        $log.warn(msg);\n        $element.html(dashboard.messageTemplate.replace(/{}/g, msg));\n      });\n\n      // destroy old scope\n      if (currentScope){\n        currentScope.$destroy();\n      }\n\n      return templateScope;\n    }\n\n    return {\n      replace: true,\n      restrict: 'EA',\n      transclude: false,\n      scope: {\n        model: '=',\n        content: '='\n      },\n      link: function($scope, $element) {\n        var currentScope = compileWidget($scope, $element, null);\n        $scope.$on('widgetReload', function(){\n          currentScope = compileWidget($scope, $element, currentScope);\n        });\n        $scope.$on('widgetConfigChanged', function(event, params){\n          // Confirm this approach!\n          if ( $scope.model.widget === params.widget ) {\n            // extend widget config with params\n            angular.extend( $scope.model.config, params.config );\n            // ee-compile widget\n            currentScope = compileWidget( $scope, $element, currentScope );\n          }\n        });        \n      }\n    };\n\n  });\n","/*\n * The MIT License\n *\n * Copyright (c) 2015, Patrick Fitzgerald\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\nangular.module('ngm')\n  .directive('ngmWidget', function($log, dashboard, ngmTemplatePath) {\n\n    function preLink($scope){\n      var definition = $scope.definition;\n      if (definition) {\n        var w = dashboard.widgets[definition.type];\n        if (w) {\n\n          // set id for sortable\n          if (!definition.wid){\n            definition.wid = dashboard.id();\n          }\n\n          // pass copy of widget to scope\n          $scope.widget = angular.copy(w);\n\n          // create config object\n          var config = definition.config;\n          if (config) {\n            if (angular.isString(config)) {\n              config = angular.fromJson(config);\n            }\n          } else {\n            config = {};\n          }\n\n          // pass config to scope\n          $scope.config = config;\n\n          // collapse exposed $scope.widgetState property\n         if(!$scope.widgetState){\n             $scope.widgetState ={};\n             $scope.widgetState.isCollapsed= false;\n          }\n\n        } else {\n          $log.warn('could not find widget ' + definition.type);\n        }\n      } else {\n        $log.debug('definition not specified, widget was probably removed');\n      }\n    }\n\n    function postLink($scope, $element) {\n      var definition = $scope.definition;\n      if (definition) {\n        // bind reload function\n        $scope.reload = function(){\n          $scope.$broadcast('widgetReload');\n        };\n      } else {\n        $log.debug('widget not found');\n      }\n    }\n\n    return {\n      replace: true,\n      restrict: 'EA',\n      transclude: false,\n      templateUrl: ngmTemplatePath + 'widget.html',\n      scope: {\n        definition: '=',\n        col: '=column',\n        editMode: '=',\n        options: '=',\n        widgetState: '='\n      },\n\n      controller: function ($scope) {\n        // \n      },\n\n      compile: function compile(){\n\n        /**\n         * use pre link, because link of widget-content\n         * is executed before post link widget\n         */\n        return {\n          pre: preLink,\n          post: postLink\n        };\n      }\n    };\n\n  });\n","angular.module(\"ngm\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"../src/templates/dashboard-column.html\",\"<div ngm-id={{column.cid}} class=col ng-class=column.styleClass ng-model=column.widgets> <ngm-widget ng-repeat=\\\"definition in column.widgets\\\" definition=definition column=column options=options widget-state=widgetState>  </ngm-widget></div> \");\n$templateCache.put(\"../src/templates/dashboard-row.html\",\"<div class=row ng-class=row.styleClass>  </div> \");\n$templateCache.put(\"../src/templates/dashboard-title.html\",\"<div class=\\\"{{ model.header.div.class }}\\\" style=\\\"{{ model.header.div.style }}\\\"> <h2 class=\\\"{{ model.header.title.class }}\\\" style=\\\"{{ model.header.title.style }}\\\"> {{ model.header.title.title }} </h2> <div style=display:inline;> <p class=\\\"{{ model.header.subtitle.class }}\\\" style=\\\"{{ model.header.subtitle.style }}\\\"> {{ model.header.subtitle.title }} </p> <div class=\\\"{{ model.header.download.class }}\\\" style=\\\"{{ model.header.download.style }}\\\">  <div ng-repeat=\\\"download in model.header.download.downloads\\\">  <ngm-dashboard-download icon=download.icon type=download.type hover=download.hover filename=download.filename datakey=download.dataKey request=download.request metrics=download.metrics> </ngm-dashboard-download> </div> </div> </div> </div> \");\n$templateCache.put(\"../src/templates/dashboard.html\",\"<div class=dashboard-container> <div ng-include src=model.titleTemplateUrl></div> <div class=dashboard> <ngm-dashboard-row row=row ngm-model=model options=options ng-repeat=\\\"row in model.rows\\\"> </ngm-dashboard-row> </div> </div> \");\n$templateCache.put(\"../src/templates/widget.html\",\"<div ngm-id=\\\"{{ definition.wid }}\\\" ngm-widget-type=\\\"{{ definition.type }}\\\" class=\\\"widget {{ definition.card }}\\\" style=\\\"{{ definition.style }}\\\"> <ngm-widget-content model=definition content=widget> </ngm-widget-content></div> \");}]);","!function(e,t){\"use strict\";angular.module(\"ngm\",[\"ngm.provider\"]).value(\"ngmTemplatePath\",\"../src/templates/\").value(\"rowTemplate\",'<ngm-dashboard-row row=\"row\" ngm-model=\"ngmModel\" options=\"options\" edit-mode=\"editMode\" ng-repeat=\"row in column.rows\" />').value(\"columnTemplate\",'<ngm-dashboard-column column=\"column\" ngm-model=\"ngmModel\" options=\"options\" edit-mode=\"editMode\" ng-repeat=\"column in row.columns\" />').value(\"ngmVersion\",\"0.0.3\"),angular.module(\"ngm\").directive(\"ngmDashboardColumn\",function(e,t,n,o,i){return{restrict:\"E\",replace:!0,scope:{column:\"=\",editMode:\"=\",ngmModel:\"=\",options:\"=\"},templateUrl:n+\"dashboard-column.html\",link:function(e,n){var l=e.column;l.cid||(l.cid=i.id()),t(o)(e,function(e){n.append(e)})}}}),angular.module(\"ngm\").directive(\"ngmMenu\",function(){return{restrict:\"A\",link:function(e,t,n){setTimeout(function(){$(\".side-menu\").find(\"li\").each(function(e,t){$(t).attr(\"class\").search(\"active\")>0&&($(t).closest(\".bold\").attr(\"class\",\"bold active\"),$(t).closest(\".bold\").find(\"a\").attr(\"class\",$(t).closest(\".bold\").find(\"a\").attr(\"class\")+\" z-depth-1\"),$(t).closest(\".collapsible-body\").slideDown(),$(t).closest(\".collapsible-body\").attr(\"class\",$(t).closest(\".collapsible-body\").attr(\"class\")+\" active\"))})},0),t.bind(\"click\",function(e){t.toggleClass(\"active\"),t.find(\".collapsible-header\").toggleClass(\"z-depth-1\"),t.find(\".collapsible-body\").toggleClass(\"active\"),t.find(\".collapsible-body\").hasClass(\"active\")?t.find(\".collapsible-body\").slideDown():t.find(\".collapsible-body\").slideUp()})}}}).directive(\"ngmDashboardDownload\",function(e){var t=angular.injector([\"ng\"]),n=t.get(\"$http\"),o={csv:function(e,t,o){n(t).success(function(t){var n,i=t[o].map(function(e){n=[];var t=[];angular.forEach(e,function(e,o){n.push(o),t.push(e)});var o=t.join();return o}),l=[];l.push(n.join()),l.push(i.join(\"\\n\"));var a=document.createElement(\"a\");a.href=\"data:attachment/csv,\"+encodeURIComponent(l),a.target=\"_blank\",a.download=e+\".csv\",document.body.appendChild(a),a.click(),a.remove()}).error(function(){deferred.reject()})},pdf:function(e,t,n){console.log(\"PDF\")},setMetrics:function(e){n(e).success(function(e){console.log(e),console.log(\"download\")}).error(function(){console.log(\"metric error\"),deferred.reject()})}};return{restrict:\"EA\",replace:!0,template:'<a class=\"tooltipped\" data-position=\"top\" data-delay=\"50\" data-tooltip=\"{{ hover }}\" style=\"color: {{ icon.color }}\"><i class=\"{{ icon.size }} material-icons\">{{ icon.type }}</i></a>',scope:{icon:\"=\",type:\"=\",hover:\"=\",dataKey:\"=\",filename:\"=\",request:\"=\",metrics:\"=\"},link:function(e,t,n){$(\".tooltipped\").tooltip({tooltip:\"Download CSV\"}),e.icon={type:e.icon&&e.icon.type?e.icon.type:\"ic_assignment_returned\",color:e.icon&&e.icon.color?e.icon.color:\"\",size:e.icon&&e.icon.size?e.icon.size:\"small\"},e.type=e.type?e.type:\"csv\",e.hover=e.hover?e.hover:\"Download \"+e.type,e.dataKey=e.dataKey?e.dataKey:\"data\",e.filename=e.filename?e.filename:moment().format(),t.bind(\"click\",function(t){o[e.type](e.filename,e.request,e.dataKey),e.metrics&&o.setMetrics(e.metrics)})}}}).directive(\"ngmDashboard\",function(e,t,n,o){function i(e){switch(angular.isDefined(e)?e.toLowerCase():null){case\"true\":case\"yes\":case\"1\":return!0;case\"false\":case\"no\":case\"0\":case null:return!1;default:return Boolean(e)}}return{replace:!0,restrict:\"EA\",transclude:!1,scope:{structure:\"@\",name:\"@\",collapsible:\"@\",editable:\"@\",maximizable:\"@\",ngmModel:\"=\",ngmWidgetFilter:\"=\"},controller:function(e){var i={},l={},a=null,r={};e.name;e.ngmModel.updateWidgets=function(t){e.$broadcast(\"updateWidgetConfigs\",t)},e.$watch(\"ngmModel\",function(d,s){(null!==s||null===d&&null===s)&&(i=e.ngmModel,a=e.ngmWidgetFilter,i&&i.rows||(r=e.structure,l=n.structures[r],l?(i?i.rows=angular.copy(l).rows:i=angular.copy(l),i.structure=r):t.error(\"could not find structure \"+r)),i?(i.title||(i.title=\"Dashboard\"),i.titleTemplateUrl||(i.titleTemplateUrl=o+\"dashboard-title.html\"),e.model=i):t.error(\"could not find or create model\"))},!0),e.editMode=!1,e.editClass=\"\"},link:function(e,t,n){var o={name:n.name,editable:!0,maximizable:i(n.maximizable),collapsible:i(n.collapsible)};angular.isDefined(n.editable)&&(o.editable=i(n.editable)),e.options=o},templateUrl:o+\"dashboard.html\"}}),angular.module(\"ngm.provider\",[]).provider(\"dashboard\",function(){var e={},t=\"\",n={},o='<div class=\"alert alert-danger\">{}</div>',i='      <div class=\"progress progress-striped active\">\\n        <div class=\"progress-bar\" role=\"progressbar\" style=\"width: 100%\">\\n          <span class=\"sr-only\">loading ...</span>\\n        </div>\\n      </div>';this.widget=function(t,n){var o=angular.extend({reload:!1},n);if(o.edit){var i={reload:!0};angular.extend(i,o.edit),o.edit=i}return e[t]=o,this},this.widgetsPath=function(e){return t=e,this},this.structure=function(e,t){return n[e]=t,this},this.messageTemplate=function(e){return o=e,this},this.loadingTemplate=function(e){return i=e,this},this.getData=function(e){var t=angular.injector([\"ng\"]),n=t.get(\"$q\"),o=t.get(\"$http\"),i=n.defer();return o(e).success(function(e){i.resolve(e)}).error(function(){i.reject()}),i.promise},this.$get=function(){var l=0;return{widgets:e,widgetsPath:t,structures:n,messageTemplate:o,loadingTemplate:i,id:function(){return++l}}}}),angular.module(\"ngm\").directive(\"ngmDashboardRow\",function(e,t,n){return{restrict:\"E\",replace:!0,scope:{row:\"=\",ngmModel:\"=\",editMode:\"=\",options:\"=\"},templateUrl:t+\"dashboard-row.html\",link:function(t,o){angular.isDefined(t.row.columns)&&angular.isArray(t.row.columns)&&e(n)(t,function(e){o.append(e)})}}}),angular.module(\"ngm\").directive(\"ngmWidgetContent\",function(e,t,n,o,i,l,a,r,d){function s(e){var t=e;return e.indexOf(\"{widgetsPath}\")>=0&&(t=e.replace(\"{widgetsPath}\",d.widgetsPath).replace(\"//\",\"/\"),0===t.indexOf(\"/\")&&(t=t.substring(1))),t}function c(e){var l=t.defer();if(e.template)l.resolve(e.template);else if(e.templateUrl){var a=i.get(e.templateUrl);if(a)l.resolve(a);else{var r=n.getTrustedResourceUrl(s(e.templateUrl));o.get(r).success(function(t){i.put(e.templateUrl,t),l.resolve(t)}).error(function(){l.reject(\"could not load template\")})}}return l.promise}function u(n,o,i){var s=n.model,u=n.content;o.html(d.loadingTemplate);var m=n.$new();s.config||(s.config={}),m.config=s.config;var g={$scope:m,$element:o.parent(),widget:s,config:s.config},p={};return p.$tpl=c(u),u.resolve&&angular.forEach(u.resolve,function(e,t){angular.isString(e)?p[t]=r.get(e):p[t]=r.invoke(e,e,g)}),t.all(p).then(function(e){angular.extend(e,g);var t=e.$tpl;if(o.html(t),u.controller){var n=a(u.controller,e);u.controllerAs&&(m[u.controllerAs]=n),o.children().data(\"$ngControllerController\",n)}l(o.contents())(m)},function(t){var n=\"Could not resolve all promises\";t&&(n+=\": \"+t),e.warn(n),o.html(d.messageTemplate.replace(/{}/g,n))}),i&&i.$destroy(),m}return{replace:!0,restrict:\"EA\",transclude:!1,scope:{model:\"=\",content:\"=\"},link:function(e,t){var n=u(e,t,null);e.$on(\"widgetReload\",function(){n=u(e,t,n)}),e.$on(\"widgetConfigChanged\",function(o,i){e.model.widget===i.widget&&(angular.extend(e.model.config,i.config),n=u(e,t,n))})}}}),angular.module(\"ngm\").directive(\"ngmWidget\",function(e,t,n){function o(n){var o=n.definition;if(o){var i=t.widgets[o.type];if(i){o.wid||(o.wid=t.id()),n.widget=angular.copy(i);var l=o.config;l?angular.isString(l)&&(l=angular.fromJson(l)):l={},n.config=l,n.widgetState||(n.widgetState={},n.widgetState.isCollapsed=!1)}else e.warn(\"could not find widget \"+o.type)}else e.debug(\"definition not specified, widget was probably removed\")}function i(t,n){var o=t.definition;o?t.reload=function(){t.$broadcast(\"widgetReload\")}:e.debug(\"widget not found\")}return{replace:!0,restrict:\"EA\",transclude:!1,templateUrl:n+\"widget.html\",scope:{definition:\"=\",col:\"=column\",editMode:\"=\",options:\"=\",widgetState:\"=\"},controller:function(e){},compile:function(){return{pre:o,post:i}}}}),angular.module(\"ngm\").run([\"$templateCache\",function(e){e.put(\"../src/templates/dashboard-column.html\",'<div ngm-id={{column.cid}} class=col ng-class=column.styleClass ng-model=column.widgets> <ngm-widget ng-repeat=\"definition in column.widgets\" definition=definition column=column options=options widget-state=widgetState>  </ngm-widget></div> '),e.put(\"../src/templates/dashboard-row.html\",\"<div class=row ng-class=row.styleClass>  </div> \"),e.put(\"../src/templates/dashboard-title.html\",'<div class=\"{{ model.header.div.class }}\" style=\"{{ model.header.div.style }}\"> <h2 class=\"{{ model.header.title.class }}\" style=\"{{ model.header.title.style }}\"> {{ model.header.title.title }} </h2> <div style=display:inline;> <p class=\"{{ model.header.subtitle.class }}\" style=\"{{ model.header.subtitle.style }}\"> {{ model.header.subtitle.title }} </p> <div class=\"{{ model.header.download.class }}\" style=\"{{ model.header.download.style }}\">  <div ng-repeat=\"download in model.header.download.downloads\">  <ngm-dashboard-download icon=download.icon type=download.type hover=download.hover filename=download.filename datakey=download.dataKey request=download.request metrics=download.metrics> </ngm-dashboard-download> </div> </div> </div> </div> '),e.put(\"../src/templates/dashboard.html\",'<div class=dashboard-container> <div ng-include src=model.titleTemplateUrl></div> <div class=dashboard> <ngm-dashboard-row row=row ngm-model=model options=options ng-repeat=\"row in model.rows\"> </ngm-dashboard-row> </div> </div> '),e.put(\"../src/templates/widget.html\",'<div ngm-id=\"{{ definition.wid }}\" ngm-widget-type=\"{{ definition.type }}\" class=\"widget {{ definition.card }}\" style=\"{{ definition.style }}\"> <ngm-widget-content model=definition content=widget> </ngm-widget-content></div> ')}])}(window);\n//# sourceMappingURL=ngm-dashboard-framework.min.js.map"],"sourceRoot":"/source/"}