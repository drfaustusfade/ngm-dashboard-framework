!function(e,t){"use strict";angular.module("ngm",["ngm.provider"]).value("ngmTemplatePath","../src/templates/").value("rowTemplate",'<ngm-dashboard-row row="row" ngm-model="ngmModel" options="options" edit-mode="editMode" ng-repeat="row in column.rows" />').value("columnTemplate",'<ngm-dashboard-column column="column" ngm-model="ngmModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("ngmVersion","0.1.0"),angular.module("ngm").service("ngmData",["$q","$http",function(e,t){return{get:function(n){var a=e.defer();return t(n).success(function(e){a.resolve(e)}).error(function(){a.reject()}),a.promise}}}]).directive("ngmDashboard",["$rootScope","$log","$sce","dashboard","ngmTemplatePath",function(e,t,n,a,o){function i(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}return{replace:!0,restrict:"EA",transclude:!1,scope:{structure:"@",name:"@",collapsible:"@",editable:"@",maximizable:"@",ngmModel:"=",ngmWidgetFilter:"="},controller:function(e){var i={},l={},r=null,d={};e.name;e.ngmModel.updateWidgets=function(t){e.$broadcast("widgetConfigChanged",t)},e.$watch("ngmModel",function(s,c){(null!==c||null===s&&null===c)&&(i=e.ngmModel,r=e.ngmWidgetFilter,i&&i.rows||(d=e.structure,l=a.structures[d],l?(i?i.rows=angular.copy(l).rows:i=angular.copy(l),i.structure=d):t.error("could not find structure "+d)),i?(i.title||(i.title="Dashboard"),i.header.title.title=n.trustAsHtml(i.header.title.title),i.header.title.subtitle=n.trustAsHtml(i.header.subtitle.subtitle),i.titleTemplateUrl||(i.titleTemplateUrl=o+"dashboard-title.html"),e.model=i):t.error("could not find or create model"))},!0),e.editMode=!1,e.editClass=""},link:function(e,t,n){var a={name:n.name,editable:!0,maximizable:i(n.maximizable),collapsible:i(n.collapsible)};angular.isDefined(n.editable)&&(a.editable=i(n.editable)),e.options=a},templateUrl:o+"dashboard.html"}}]).directive("ngmMenu",function(){return{restrict:"A",link:function(e,t,n){setTimeout(function(){$(".side-menu").find("li").each(function(e,t){$(t).attr("class").search("active")>0&&($(t).closest(".bold").attr("class","bold active"),$(t).closest(".bold").find("a").attr("class",$(t).closest(".bold").find("a").attr("class")+" z-depth-1"),$(t).closest(".collapsible-body").slideDown(),$(t).closest(".collapsible-body").attr("class",$(t).closest(".collapsible-body").attr("class")+" active"))})},0),t.bind("click",function(e){t.toggleClass("active"),t.find(".collapsible-header").toggleClass("z-depth-1"),t.find(".collapsible-body").toggleClass("active"),t.find(".collapsible-body").hasClass("active")?t.find(".collapsible-body").slideDown():t.find(".collapsible-body").slideUp()})}}}).directive("ngmDashboardDownload",["dashboard","ngmData",function(t,n){var a={csv:function(e,t,a){n.get(t).then(function(t){var n,o=t[a].map(function(e){n=[];var t=[];angular.forEach(e,function(e,a){n.push(a),t.push(e)});var a=t.join();return a}),i=[];i.push(n.join()),i.push(o.join("\n"));var l=document.createElement("a");l.href="data:attachment/csv,"+encodeURIComponent(i),l.target="_blank",l.download=e+".csv",document.body.appendChild(l),l.click(),l.remove()})},pdf:function(t,n,a){e.open(t,"_blank")},setMetrics:function(e){n.get(e).then(function(e){})}};return{restrict:"EA",replace:!0,template:'<li><a class="btn-floating {{ color }} tooltipped" data-position="bottom" data-delay="50" data-tooltip="{{ hover }}"><i class="material-icons">{{ icon }}</i></a></li>',scope:{type:"=",icon:"=",color:"=",hover:"=",dataKey:"=",filename:"=",request:"=",metrics:"="},link:function(e,t,n){$(".tooltipped").tooltip({tooltip:"Download CSV"}),e.type=e.type?e.type:"csv",e.icon=e.icon?e.icon:"cloud_download",e.color=e.color?e.color:"blue",e.hover=e.hover?e.hover:"Download "+e.type.toUpperCase(),e.dataKey=e.dataKey?e.dataKey:"data",e.filename=e.filename?e.filename:moment().format(),t.bind("click",function(t){a[e.type](e.filename,e.request,e.dataKey),e.metrics&&a.setMetrics(e.metrics)})}}}]).directive("ngModel",["$timeout",function(e){return{restrict:"A",priority:-1,link:function(n,a,o){n.$watch(o.ngModel,function(n){e(function(){n?a.trigger("change"):a.attr("placeholder")===t&&(a.is(":focus")||a.trigger("blur"))})})}}}]).directive("ngmDate",["$compile","$timeout",function(e,n){var a=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,o=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(l,r,d){var s=a;if(1!==arguments.length||"[object String]"!=Object.prototype.toString.call(l)||/\d/.test(l)||(r=l,l=t),l=l?new Date(l):new Date,isNaN(l))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),d=!0);var c=d?"getUTC":"get",m=l[c+"Date"](),u=l[c+"Day"](),g=l[c+"Month"](),p=l[c+"FullYear"](),f=l[c+"Hours"](),h=l[c+"Minutes"](),y=l[c+"Seconds"](),v=l[c+"Milliseconds"](),b=d?0:l.getTimezoneOffset(),w={d:m,dd:i(m),ddd:s.i18n.dayNames[u],dddd:s.i18n.dayNames[u+7],m:g+1,mm:i(g+1),mmm:s.i18n.monthNames[g],mmmm:s.i18n.monthNames[g+12],yy:String(p).slice(2),yyyy:p,h:f%12||12,hh:i(f%12||12),H:f,HH:i(f),M:h,MM:i(h),s:y,ss:i(y),l:i(v,3),L:i(v>99?Math.round(v/10):v),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:d?"UTC":(String(l).match(n)||[""]).pop().replace(o,""),o:(b>0?"-":"+")+i(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:["th","st","nd","rd"][m%10>3?0:(m%100-m%10!=10)*m%10]};return r.replace(e,function(e){return e in w?w[e]:e.slice(1,e.length-1)})}}();a.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},a.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return a(this,e,t)};return{require:"ngModel",scope:{container:"@",format:"@",formatSubmit:"@",monthsFull:"@",monthsShort:"@",weekdaysFull:"@",weekdaysLetter:"@",firstDay:"=",disable:"=",today:"=",clear:"=",close:"=",selectYears:"=",onStart:"&",onRender:"&",onOpen:"&",onClose:"&",onSet:"&",onStop:"&",onSelection:"&",ngReadonly:"=?",max:"@",min:"@"},link:function(e,n,a,o){e.$watch(function(){return o.$modelValue},function(t,n){angular.equals(t,n)||angular.isDefined(e.onSelection)&&e.onSelection()}),o.$formatters.unshift(function(t){if(t){var n=new Date(t);return angular.isDefined(e.format)?n.format(e.format):n.format("d mmmm, yyyy")}return null});var i=n.pickadate({selectMonths:!0,selectYears:15,format:angular.isDefined(e.format)?e.format:t,min:angular.isDefined(e.min)?e.min:t,max:angular.isDefined(e.max)?e.max:t,onStart:function(){setTimeout(function(){var e=o.$modelValue;l.set("select",[new Date(e).getFullYear(),new Date(e).getMonth(),new Date(e).getDate()])},0)},onRender:function(){},onSet:function(e){e.select&&l.close()}}),l=i.pickadate("picker")}}}]),angular.module("ngm.provider",[]).provider("dashboard",function(){var e={},t="",n={},a='<div class="alert alert-danger">{}</div>',o='			<div class="progress progress-striped active">\n				<div class="progress-bar" role="progressbar" style="width: 100%">\n					<span class="sr-only">loading ...</span>\n				</div>\n			</div>';this.widget=function(t,n){var a=angular.extend({reload:!1},n);if(a.edit){var o={reload:!0};angular.extend(o,a.edit),a.edit=o}return e[t]=a,this},this.widgetsPath=function(e){return t=e,this},this.structure=function(e,t){return n[e]=t,this},this.messageTemplate=function(e){return a=e,this},this.loadingTemplate=function(e){return o=e,this},this.$get=function(){var i=0;return{widgets:e,widgetsPath:t,structures:n,messageTemplate:a,loadingTemplate:o,id:function(){return++i}}}}),angular.module("ngm").directive("ngmDashboardRow",function(e,t,n){return{restrict:"E",replace:!0,scope:{row:"=",ngmModel:"=",editMode:"=",options:"="},templateUrl:t+"dashboard-row.html",link:function(t,a){angular.isDefined(t.row.columns)&&angular.isArray(t.row.columns)&&e(n)(t,function(e){a.append(e)})}}}),angular.module("ngm").directive("ngmDashboardColumn",function(e,t,n,a,o){return{restrict:"E",replace:!0,scope:{column:"=",editMode:"=",ngmModel:"=",options:"="},templateUrl:n+"dashboard-column.html",link:function(e,n){var i=e.column;i.cid||(i.cid=o.id()),t(a)(e,function(e){n.append(e)})}}}),angular.module("ngm").directive("ngmWidgetContent",function(e,t,n,a,o,i,l,r,d){function s(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",d.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}function c(e){var i=t.defer();if(e.template)i.resolve(e.template);else if(e.templateUrl){var l=o.get(e.templateUrl);if(l)i.resolve(l);else{var r=n.getTrustedResourceUrl(s(e.templateUrl));a.get(r).success(function(t){o.put(e.templateUrl,t),i.resolve(t)}).error(function(){i.reject("could not load template")})}}return i.promise}function m(n,a,o){var s=n.model,m=n.content;a.html(d.loadingTemplate);var u=n.$new();s.config||(s.config={}),u.config=s.config;var g={$scope:u,$element:a.parent(),widget:s,config:s.config},p={};return p.$tpl=c(m),m.resolve&&angular.forEach(m.resolve,function(e,t){angular.isString(e)?p[t]=r.get(e):p[t]=r.invoke(e,e,g)}),t.all(p).then(function(e){angular.extend(e,g);var t=e.$tpl;if(a.html(t),m.controller){var n=l(m.controller,e);m.controllerAs&&(u[m.controllerAs]=n),a.children().data("$ngControllerController",n)}i(a.contents())(u)},function(t){var n="Could not resolve all promises";t&&(n+=": "+t),e.warn(n),a.html(d.messageTemplate.replace(/{}/g,n))}),o&&o.$destroy(),u}return{replace:!0,restrict:"EA",transclude:!1,scope:{model:"=",content:"="},link:function(e,t){var n=m(e,t,null);e.$on("widgetReload",function(){n=m(e,t,n)}),e.$on("widgetConfigChanged",function(a,o){e.model.broadcast===o.broadcast&&(e.model.config=angular.merge({},e.model.config,o.config),n=m(e,t,n))})}}}),angular.module("ngm").directive("ngmWidget",function(e,t,n){function a(n){var a=n.definition;if(a){var o=t.widgets[a.type];if(o){a.wid||(a.wid=t.id()),n.widget=angular.copy(o);var i=a.config;i?angular.isString(i)&&(i=angular.fromJson(i)):i={},n.config=i,n.widgetState||(n.widgetState={},n.widgetState.isCollapsed=!1)}else e.warn("could not find widget "+a.type)}else e.debug("definition not specified, widget was probably removed")}function o(t,n){var a=t.definition;a?t.reload=function(){t.$broadcast("widgetReload")}:e.debug("widget not found")}return{replace:!0,restrict:"EA",transclude:!1,templateUrl:n+"widget.html",scope:{definition:"=",col:"=column",editMode:"=",options:"=",widgetState:"="},controller:function(e){},compile:function(){return{pre:a,post:o}}}}),angular.module("ngm").run(["$templateCache",function(e){e.put("../src/templates/dashboard-column.html",'<div ngm-id={{column.cid}} class=col ng-class=column.styleClass ng-model=column.widgets> <ngm-widget ng-repeat="definition in column.widgets" definition=definition column=column options=options widget-state=widgetState>  </ngm-widget></div> '),e.put("../src/templates/dashboard-row.html","<div class=row ng-class=row.styleClass>  </div> "),e.put("../src/templates/dashboard-title.html",' <div class="{{ model.header.div.class }}" style="{{ model.header.div.style }}">  <div class=row>  <h2 class="{{ model.header.title.class }}" style="{{ model.header.title.style }}" ng-bind-html=model.header.title.title> </h2>  <div class="{{ model.header.download.class }}" style="{{ model.header.download.style }}" align=right ng-if=model.header.download> <div class="fixed-action-btn horizontal" style="position: relative; display: inline-block; margin-top:66px;"> <a class="btn-floating btn-large teal"> <i class="large material-icons">cloud_download</i> </a> <ul>  <div>  <ngm-dashboard-download ng-repeat="data in model.header.download.downloads track by $index" type=data.type color=data.color icon=data.icon hover=data.hover filename=data.filename request=data.request metrics=data.metrics> </ngm-dashboard-download> </div> </ul> </div> </div> </div>  <div class=row>  <p class="{{ model.header.subtitle.class }}" style="{{ model.header.subtitle.style }}" ng-bind-html=model.header.subtitle.title> </p>  <div class="{{ model.header.datePicker.class }}" style="{{ model.header.datePicker.style }}"> <div ng-repeat="date in model.header.datePicker.dates track by $index">  <div id="ngmDateContainer-{{ $index }}" class="{{ date.class }}" style="{{ date.style }}"> <label for="ngmStartDate-{{ $index }}">{{ date.label }}</label> <input ngm-date id=ngmStartDate type=text class=datepicker ng-model=date.time format="{{ date.format }}" on-selection=date.onSelection()> </div> </div> </div> </div> </div> '),e.put("../src/templates/dashboard.html",'<div class=dashboard-container> <div ng-include src=model.titleTemplateUrl></div> <div class=dashboard> <ngm-dashboard-row row=row ngm-model=model options=options ng-repeat="row in model.rows"> </ngm-dashboard-row> </div> </div> '),e.put("../src/templates/widget.html",'<div ngm-id="{{ definition.wid }}" ngm-widget-type="{{ definition.type }}" class="widget {{ definition.card }}" style="{{ definition.style }}"> <ngm-widget-content model=definition content=widget> </ngm-widget-content></div> ')}])}(window);
//# sourceMappingURL=ngm-dashboard-framework.min.js.map