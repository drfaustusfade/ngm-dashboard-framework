!function(e,t){"use strict";angular.module("ngm",["ngm.provider"]).value("ngmTemplatePath","../src/templates/").value("rowTemplate",'<ngm-dashboard-row row="row" ngm-model="ngmModel" options="options" edit-mode="editMode" ng-repeat="row in column.rows" />').value("columnTemplate",'<ngm-dashboard-column column="column" ngm-model="ngmModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("ngmVersion","0.0.15"),angular.module("ngm").service("ngmData",function(e,t){return{get:function(n){var o=e.defer();return t(n).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise}}}).directive("ngmDashboard",function(e,t,n,o){function a(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}return{replace:!0,restrict:"EA",transclude:!1,scope:{structure:"@",name:"@",collapsible:"@",editable:"@",maximizable:"@",ngmModel:"=",ngmWidgetFilter:"="},controller:function(e){var a={},i={},l=null,r={};e.name;e.ngmModel.updateWidgets=function(t){e.$broadcast("widgetConfigChanged",t)},e.$watch("ngmModel",function(d,s){(null!==s||null===d&&null===s)&&(a=e.ngmModel,l=e.ngmWidgetFilter,a&&a.rows||(r=e.structure,i=n.structures[r],i?(a?a.rows=angular.copy(i).rows:a=angular.copy(i),a.structure=r):t.error("could not find structure "+r)),a?(a.title||(a.title="Dashboard"),a.titleTemplateUrl||(a.titleTemplateUrl=o+"dashboard-title.html"),e.model=a):t.error("could not find or create model"))},!0),e.editMode=!1,e.editClass=""},link:function(e,t,n){var o={name:n.name,editable:!0,maximizable:a(n.maximizable),collapsible:a(n.collapsible)};angular.isDefined(n.editable)&&(o.editable=a(n.editable)),e.options=o},templateUrl:o+"dashboard.html"}}).directive("ngmMenu",function(){return{restrict:"A",link:function(e,t,n){setTimeout(function(){$(".side-menu").find("li").each(function(e,t){$(t).attr("class").search("active")>0&&($(t).closest(".bold").attr("class","bold active"),$(t).closest(".bold").find("a").attr("class",$(t).closest(".bold").find("a").attr("class")+" z-depth-1"),$(t).closest(".collapsible-body").slideDown(),$(t).closest(".collapsible-body").attr("class",$(t).closest(".collapsible-body").attr("class")+" active"))})},0),t.bind("click",function(e){t.toggleClass("active"),t.find(".collapsible-header").toggleClass("z-depth-1"),t.find(".collapsible-body").toggleClass("active"),t.find(".collapsible-body").hasClass("active")?t.find(".collapsible-body").slideDown():t.find(".collapsible-body").slideUp()})}}}).directive("ngmDashboardDownload",function(e,t){var n={csv:function(e,n,o){t.get(n).then(function(t){var n,a=t[o].map(function(e){n=[];var t=[];angular.forEach(e,function(e,o){n.push(o),t.push(e)});var o=t.join();return o}),i=[];i.push(n.join()),i.push(a.join("\n"));var l=document.createElement("a");l.href="data:attachment/csv,"+encodeURIComponent(i),l.target="_blank",l.download=e+".csv",document.body.appendChild(l),l.click(),l.remove()})},pdf:function(e,t,n){console.log("PDF")},setMetrics:function(e){t.get(e).then(function(e){})}};return{restrict:"EA",replace:!0,template:'<a class="tooltipped" data-position="left" data-delay="50" data-tooltip="{{ hover }}"><button style="width: 100%;" class="btn btn-large waves-effect waves-teal" type="submit">Download CSV</button>',scope:{icon:"=",type:"=",hover:"=",dataKey:"=",filename:"=",request:"=",metrics:"="},link:function(e,t,o){$(".tooltipped").tooltip({tooltip:"Download CSV"}),e.icon={type:e.icon&&e.icon.type?e.icon.type:"ic_assignment_returned",color:e.icon&&e.icon.color?e.icon.color:"",size:e.icon&&e.icon.size?e.icon.size:"small"},e.type=e.type?e.type:"csv",e.hover=e.hover?e.hover:"Download "+e.type,e.dataKey=e.dataKey?e.dataKey:"data",e.filename=e.filename?e.filename:moment().format(),t.bind("click",function(t){n[e.type](e.filename,e.request,e.dataKey),e.metrics&&n.setMetrics(e.metrics)})}}}).directive("ngModel",["$timeout",function(e){return{restrict:"A",priority:-1,link:function(n,o,a){n.$watch(a.ngModel,function(n){e(function(){n?o.trigger("change"):o.attr("placeholder")===t&&(o.is(":focus")||o.trigger("blur"))})})}}}]).directive("ngmDate",["$compile","$timeout",function(e,n){var o=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,i=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(l,r,d){var s=o;if(1!==arguments.length||"[object String]"!=Object.prototype.toString.call(l)||/\d/.test(l)||(r=l,l=t),l=l?new Date(l):new Date,isNaN(l))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),d=!0);var c=d?"getUTC":"get",m=l[c+"Date"](),u=l[c+"Day"](),g=l[c+"Month"](),f=l[c+"FullYear"](),p=l[c+"Hours"](),h=l[c+"Minutes"](),y=l[c+"Seconds"](),v=l[c+"Milliseconds"](),w=d?0:l.getTimezoneOffset(),b={d:m,dd:i(m),ddd:s.i18n.dayNames[u],dddd:s.i18n.dayNames[u+7],m:g+1,mm:i(g+1),mmm:s.i18n.monthNames[g],mmmm:s.i18n.monthNames[g+12],yy:String(f).slice(2),yyyy:f,h:p%12||12,hh:i(p%12||12),H:p,HH:i(p),M:h,MM:i(h),s:y,ss:i(y),l:i(v,3),L:i(v>99?Math.round(v/10):v),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:d?"UTC":(String(l).match(n)||[""]).pop().replace(a,""),o:(w>0?"-":"+")+i(100*Math.floor(Math.abs(w)/60)+Math.abs(w)%60,4),S:["th","st","nd","rd"][m%10>3?0:(m%100-m%10!=10)*m%10]};return r.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();o.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return o(this,e,t)};return{require:"ngModel",scope:{container:"@",format:"@",formatSubmit:"@",monthsFull:"@",monthsShort:"@",weekdaysFull:"@",weekdaysLetter:"@",firstDay:"=",disable:"=",today:"=",clear:"=",close:"=",selectYears:"=",onStart:"&",onRender:"&",onOpen:"&",onClose:"&",onSet:"&",onStop:"&",onSelection:"&",ngReadonly:"=?",max:"@",min:"@"},link:function(e,n,o,a){e.$watch(function(){return a.$modelValue},function(t,n){angular.equals(t,n)||angular.isDefined(e.onSelection)&&e.onSelection()}),a.$formatters.unshift(function(t){if(t){var n=new Date(t);return angular.isDefined(e.format)?n.format(e.format):n.format("d mmmm, yyyy")}return null});var i=n.pickadate({selectMonths:!0,selectYears:15,format:angular.isDefined(e.format)?e.format:t,min:angular.isDefined(e.min)?e.min:t,max:angular.isDefined(e.max)?e.max:t,onStart:function(){setTimeout(function(){var e=a.$modelValue;l.set("select",[new Date(e).getFullYear(),new Date(e).getMonth(),new Date(e).getDate()])},0)},onRender:function(){},onSet:function(e){e.select&&l.close()}}),l=i.pickadate("picker")}}}]),angular.module("ngm.provider",[]).provider("dashboard",function(){var e={},t="",n={},o='<div class="alert alert-danger">{}</div>',a='			<div class="progress progress-striped active">\n				<div class="progress-bar" role="progressbar" style="width: 100%">\n					<span class="sr-only">loading ...</span>\n				</div>\n			</div>';this.widget=function(t,n){var o=angular.extend({reload:!1},n);if(o.edit){var a={reload:!0};angular.extend(a,o.edit),o.edit=a}return e[t]=o,this},this.widgetsPath=function(e){return t=e,this},this.structure=function(e,t){return n[e]=t,this},this.messageTemplate=function(e){return o=e,this},this.loadingTemplate=function(e){return a=e,this},this.$get=function(){var i=0;return{widgets:e,widgetsPath:t,structures:n,messageTemplate:o,loadingTemplate:a,id:function(){return++i}}}}),angular.module("ngm").directive("ngmDashboardRow",function(e,t,n){return{restrict:"E",replace:!0,scope:{row:"=",ngmModel:"=",editMode:"=",options:"="},templateUrl:t+"dashboard-row.html",link:function(t,o){angular.isDefined(t.row.columns)&&angular.isArray(t.row.columns)&&e(n)(t,function(e){o.append(e)})}}}),angular.module("ngm").directive("ngmDashboardColumn",function(e,t,n,o,a){return{restrict:"E",replace:!0,scope:{column:"=",editMode:"=",ngmModel:"=",options:"="},templateUrl:n+"dashboard-column.html",link:function(e,n){var i=e.column;i.cid||(i.cid=a.id()),t(o)(e,function(e){n.append(e)})}}}),angular.module("ngm").directive("ngmWidgetContent",function(e,t,n,o,a,i,l,r,d){function s(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",d.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}function c(e){var i=t.defer();if(e.template)i.resolve(e.template);else if(e.templateUrl){var l=a.get(e.templateUrl);if(l)i.resolve(l);else{var r=n.getTrustedResourceUrl(s(e.templateUrl));o.get(r).success(function(t){a.put(e.templateUrl,t),i.resolve(t)}).error(function(){i.reject("could not load template")})}}return i.promise}function m(n,o,a){var s=n.model,m=n.content;o.html(d.loadingTemplate);var u=n.$new();s.config||(s.config={}),u.config=s.config;var g={$scope:u,$element:o.parent(),widget:s,config:s.config},f={};return f.$tpl=c(m),m.resolve&&angular.forEach(m.resolve,function(e,t){angular.isString(e)?f[t]=r.get(e):f[t]=r.invoke(e,e,g)}),t.all(f).then(function(e){angular.extend(e,g);var t=e.$tpl;if(o.html(t),m.controller){var n=l(m.controller,e);m.controllerAs&&(u[m.controllerAs]=n),o.children().data("$ngControllerController",n)}i(o.contents())(u)},function(t){var n="Could not resolve all promises";t&&(n+=": "+t),e.warn(n),o.html(d.messageTemplate.replace(/{}/g,n))}),a&&a.$destroy(),u}return{replace:!0,restrict:"EA",transclude:!1,scope:{model:"=",content:"="},link:function(e,t){var n=m(e,t,null);e.$on("widgetReload",function(){n=m(e,t,n)}),e.$on("widgetConfigChanged",function(o,a){e.model.broadcast===a.broadcast&&(n.config=angular.merge({},e.model.config,a.config),n=m(e,t,n))})}}}),angular.module("ngm").directive("ngmWidget",function(e,t,n){function o(n){var o=n.definition;if(o){var a=t.widgets[o.type];if(a){o.wid||(o.wid=t.id()),n.widget=angular.copy(a);var i=o.config;i?angular.isString(i)&&(i=angular.fromJson(i)):i={},n.config=i,n.widgetState||(n.widgetState={},n.widgetState.isCollapsed=!1)}else e.warn("could not find widget "+o.type)}else e.debug("definition not specified, widget was probably removed")}function a(t,n){var o=t.definition;o?t.reload=function(){t.$broadcast("widgetReload")}:e.debug("widget not found")}return{replace:!0,restrict:"EA",transclude:!1,templateUrl:n+"widget.html",scope:{definition:"=",col:"=column",editMode:"=",options:"=",widgetState:"="},controller:function(e){},compile:function(){return{pre:o,post:a}}}}),angular.module("ngm").run(["$templateCache",function(e){e.put("../src/templates/dashboard-column.html",'<div ngm-id={{column.cid}} class=col ng-class=column.styleClass ng-model=column.widgets> <ngm-widget ng-repeat="definition in column.widgets" definition=definition column=column options=options widget-state=widgetState>  </ngm-widget></div> '),e.put("../src/templates/dashboard-row.html","<div class=row ng-class=row.styleClass>  </div> "),e.put("../src/templates/dashboard-title.html",' <div class="{{ model.header.div.class }}" style="{{ model.header.div.style }}"> <div class=row>  <h2 class="{{ model.header.title.class }}" style="{{ model.header.title.style }}"> {{ model.header.title.title }} </h2>  <div class="{{ model.header.download.class }}" style="{{ model.header.download.style }}" ng-repeat="download in model.header.download.downloads">  <ngm-dashboard-download icon=download.icon type=download.type hover=download.hover filename=download.filename datakey=download.dataKey request=download.request metrics=download.metrics> </ngm-dashboard-download> </div> </div> <div class=row>  <p class="{{ model.header.subtitle.class }}" style="{{ model.header.subtitle.style }}"> {{ model.header.subtitle.title }} </p>  <div class="{{ model.header.datePicker.class }}"> <div ng-repeat="date in model.header.datePicker.dates track by $index">  <div id="ngmDateContainer-{{ $index }}" class="{{ date.class }}" style="{{ date.style }}"> <label for="ngmStartDate-{{ $index }}">{{ date.label }}</label> <input ngm-date id=ngmStartDate type=text class=datepicker ng-model=date.time format="{{ date.format }}" on-selection=date.onSelection()> </div> </div> </div> </div> </div> '),e.put("../src/templates/dashboard.html",'<div class=dashboard-container> <div ng-include src=model.titleTemplateUrl></div> <div class=dashboard> <ngm-dashboard-row row=row ngm-model=model options=options ng-repeat="row in model.rows"> </ngm-dashboard-row> </div> </div> '),e.put("../src/templates/widget.html",'<div ngm-id="{{ definition.wid }}" ngm-widget-type="{{ definition.type }}" class="widget {{ definition.card }}" style="{{ definition.style }}"> <ngm-widget-content model=definition content=widget> </ngm-widget-content></div> ')}])}(window);
//# sourceMappingURL=ngm-dashboard-framework.min.js.map